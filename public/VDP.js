var VDP = {};
var store = {
  tokens: ['rolls-roycemotorcarsoc'],
  vehicle: [
    {
      siteToken: 'rolls-roycemotorcarsoc',
      lotToken: 'rolls-roycemotorcarsoc',
      lotName: 'Rolls Royce Motor Cars OC',
      vin: 'SCA665C5XFUX85455',
      condition: 'used',
      certified: false,
      year: '2015',
      make: 'Rolls-Royce',
      model: 'Wraith',
      trim: '',
      label: '2015 Rolls-Royce Wraith ',
      stockNum: 'R1255A',
      acode: 'USC50RRC081A0',
      pricing: {
        display: [
          {
            label: 'Price&colon;',
            value: '&dollar;169,987',
            attributes: {
              class: 'base-price',
            },
          },
        ],
        data: {
          msrp: 0,
          internet: 169987,
          override: {
            cms: {
              total: 0,
              items: [],
            },
          },
          discount: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          markup: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          incentive: {
            total: 0,
            conditionalTotal: 0,
            items: [],
            conditional: [],
            select: [],
          },
          final: 169987,
          conditional: 0,
          feed: {
            internet: 169987,
            invoice: null,
            priceFinal: 169987,
            onSale: false,
            range: {
              low: 304350,
              high: 304350,
            },
          },
        },
      },
      historicalPricing: [],
      monthlyPayment: [],
      engine: {
        nameFull: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        nameSimple: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        size: '6.6L',
        cylinders: null,
        fuel: 'Gasoline',
        mpgCity: '13',
        mpgHwy: '21',
        mpgE: null,
      },
      transmission: {
        description: '',
        driveTypeAbbr: 'RWD',
        driveTypeDesc: 'Rear-wheel Drive',
        speeds: '8',
        type: 'Automatic',
      },
      bodyStyle: 'Coupe',
      doors: '2',
      mileage: '29749',
      history: {
        daysInStock: '414',
        prevOwners: null,
      },
      color: {
        exterior: {
          name: 'Diamond Black',
          generic: 'Black',
          code: '',
          hex: null,
          rgb: null,
        },
        interior: {
          name: 'Diamond Black',
          generic: 'Black',
          code: '',
          hex: '',
          rgb: '',
        },
      },
      media: {
        image: {
          thumb: {
            src:
              'https://secure.images.demo.dev.pixelmotiondemo.com/thumbs/rolls-roycemotorcarsoc/SCA665C5XFUX85455/YmeYa-20190310163826.jpg',
            flip: 0,
            rotate: 0,
          },
          detail:
            'http://vehicle-photos-published.vauto.com/f0/7a/a2/ab-d8a2-418b-8811-e38a673cab5e/image-1.jpg',
        },
        video: '',
      },
      status: 'available',
      in_transit: false,
      featured: false,
      advertisement:
        'CARFAX One-Owner. Clean CARFAX. Diamond Black 2015 Rolls-Royce Wraith RWD 8-Speed Automatic 6.6L V12 DGI DOHC 48V Twin Turbocharged',
      dealerComments: '',
      vehicleCodes: {
        autodata: 'USC50RRC081A0',
        year: 'C50',
        engine: ['RR05'],
        language: 'EN',
        manufacturer: 'WRAITH1',
        engineOption: 'STDEN',
        installed: null,
      },
      accessories: [],
      pricingIncentive: [],
      flags: ['carfax-1-owner'],
      vdp_href:
        '/inventory/display/used/2015/Rolls-Royce/Wraith/SCA665C5XFUX85455',
      incentives: {
        bestOffer: [],
        select: [],
        conditional: [],
      },
      installedOptions: [
        'DVD / Entertainment',
        'Memory Seats',
        'Navigation System',
        'Rain Sensing Wipers',
        'Rear Air Conditioning',
      ],
      stats: [
        {
          label: 'Year&colon;',
          value: '2015',
          attributes: {
            class: 'vlp-vehicle-year',
          },
        },
        {
          label: 'Exterior Color&colon;',
          value: 'Diamond Black',
          attributes: {
            class: 'vlp-item-color-exterior',
          },
        },
        {
          label: 'Interior Color&colon;',
          value: 'Diamond Black',
          attributes: {
            class: 'vlp-item-color-interior',
          },
        },
        {
          label: 'Mileage&colon;',
          value: 29749,
          attributes: {
            class: 'vlp-item-mileage',
          },
        },
      ],
      cta_row: [
        {
          element: 'a',
          label: ' View Details',
          icon: '',
          attributes: {
            href:
              '/inventory/display/used/2015/Rolls-Royce/Wraith/SCA665C5XFUX85455',
            class: 'cta-button btn view-details-btn',
          },
        },
      ],
      cta_column: [],
      misc_display: [],
    },
    {
      siteToken: 'rolls-roycemotorcarsoc',
      lotToken: 'rolls-roycemotorcarsoc',
      lotName: 'Rolls Royce Motor Cars OC',
      vin: 'SCA666D51JU115774',
      condition: 'new',
      certified: false,
      year: '2018',
      make: 'Rolls-Royce',
      model: 'Dawn',
      trim: '',
      label: '2018 Rolls-Royce Dawn ',
      stockNum: 'R1308',
      acode: 'USC80RRC091A0',
      pricing: {
        display: [
          {
            label: 'MSRP&colon;',
            value: '&dollar;405,725',
            attributes: {
              class: 'base-price',
            },
          },
        ],
        data: {
          msrp: 405725,
          internet: 0,
          override: {
            cms: {
              total: 0,
              items: [],
            },
          },
          discount: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          markup: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          incentive: {
            total: 0,
            conditionalTotal: 0,
            items: [],
            conditional: [],
            select: [],
          },
          final: 405725,
          conditional: 0,
          feed: {
            list: 405725,
            invoice: null,
            priceFinal: 405725,
            onSale: false,
            range: {
              low: 346300,
              high: 346300,
            },
          },
        },
      },
      historicalPricing: [],
      monthlyPayment: [],
      engine: {
        nameFull: 'V12',
        nameSimple: 'V12',
        size: '6.6L',
        cylinders: null,
        fuel: 'Gasoline',
        mpgCity: '12',
        mpgHwy: '18',
        mpgE: null,
      },
      transmission: {
        description: '',
        driveTypeAbbr: 'RWD',
        driveTypeDesc: 'Rear-wheel Drive',
        speeds: '8',
        type: 'Automatic',
      },
      bodyStyle: 'Convertible',
      doors: '2',
      mileage: '7',
      history: {
        daysInStock: '301',
        prevOwners: null,
      },
      color: {
        exterior: {
          name: 'Arctic White',
          generic: 'White',
          code: '',
          hex: null,
          rgb: null,
        },
        interior: {
          name: 'Arctic White/bl',
          generic: 'White',
          code: '',
          hex: '',
          rgb: '',
        },
      },
      media: {
        image: {
          thumb: {
            src:
              'https://secure.images.demo.dev.pixelmotiondemo.com/thumbs/rolls-roycemotorcarsoc/SCA666D51JU115774/5dmsF-20190321105055.jpg',
            flip: 0,
            rotate: 0,
          },
          detail:
            'http://vehicle-photos-published.vauto.com/0c/f6/c1/42-c499-42c0-91ae-8094d7de4c2d/image-1.jpg',
        },
        video: '',
      },
      status: 'available',
      in_transit: false,
      featured: false,
      advertisement: '',
      dealerComments: '',
      vehicleCodes: {
        autodata: 'USC80RRC091A0',
        year: 'C80',
        engine: ['RR01', 'RR06'],
        language: 'EN',
        manufacturer: 'Dawn',
        engineOption: 'STDEN',
        installed: null,
      },
      accessories: [],
      pricingIncentive: [],
      flags: [],
      vdp_href:
        '/inventory/display/new/2018/Rolls-Royce/Dawn/SCA666D51JU115774',
      incentives: {
        bestOffer: [],
        select: [],
        conditional: [],
      },
      installedOptions: [
        'DVD / Entertainment',
        'Leather Seats',
        'Memory Seats',
        'Navigation System',
        'Rain Sensing Wipers',
        'Rear Air Conditioning',
      ],
      stats: [
        {
          label: 'Year&colon;',
          value: '2018',
          attributes: {
            class: 'vlp-vehicle-year',
          },
        },
        {
          label: 'Exterior Color&colon;',
          value: 'Arctic White',
          attributes: {
            class: 'vlp-item-color-exterior',
          },
        },
        {
          label: 'Interior Color&colon;',
          value: 'Arctic White/bl',
          attributes: {
            class: 'vlp-item-color-interior',
          },
        },
        {
          label: 'Mileage&colon;',
          value: 7,
          attributes: {
            class: 'vlp-item-mileage',
          },
        },
      ],
      cta_row: [
        {
          element: 'a',
          label: ' View Details',
          icon: '',
          attributes: {
            href:
              '/inventory/display/new/2018/Rolls-Royce/Dawn/SCA666D51JU115774',
            class: 'cta-button btn view-details-btn',
          },
        },
      ],
      cta_column: [],
      misc_display: [],
    },
    {
      siteToken: 'rolls-roycemotorcarsoc',
      lotToken: 'rolls-roycemotorcarsoc',
      lotName: 'Rolls Royce Motor Cars OC',
      vin: 'SCA665C50FUX85545',
      condition: 'used',
      certified: true,
      year: '2015',
      make: 'Rolls-Royce',
      model: 'Wraith',
      trim: '',
      label: '2015 Rolls-Royce Wraith ',
      stockNum: 'R1228A',
      acode: 'USC50RRC081A0',
      pricing: {
        display: [
          {
            label: 'Price&colon;',
            value: '&dollar;172,899',
            attributes: {
              class: 'base-price',
            },
          },
        ],
        data: {
          msrp: 0,
          internet: 172899,
          override: {
            cms: {
              total: 0,
              items: [],
            },
          },
          discount: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          markup: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          incentive: {
            total: 0,
            conditionalTotal: 0,
            items: [],
            conditional: [],
            select: [],
          },
          final: 172899,
          conditional: 0,
          feed: {
            internet: 172899,
            invoice: null,
            priceFinal: 172899,
            onSale: false,
            range: {
              low: 304350,
              high: 304350,
            },
          },
        },
      },
      historicalPricing: [],
      monthlyPayment: [],
      engine: {
        nameFull: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        nameSimple: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        size: '6.6L',
        cylinders: null,
        fuel: 'Gasoline',
        mpgCity: '13',
        mpgHwy: '21',
        mpgE: null,
      },
      transmission: {
        description: '',
        driveTypeAbbr: 'RWD',
        driveTypeDesc: 'Rear-wheel Drive',
        speeds: '8',
        type: 'Automatic',
      },
      bodyStyle: 'Coupe',
      doors: '2',
      mileage: '22503',
      history: {
        daysInStock: '747',
        prevOwners: null,
      },
      color: {
        exterior: {
          name: 'Diamond Black',
          generic: 'Black',
          code: '',
          hex: null,
          rgb: null,
        },
        interior: {
          name: 'Black',
          generic: 'Black',
          code: '',
          hex: '',
          rgb: '',
        },
      },
      media: {
        image: {
          thumb: {
            src:
              'https://secure.images.demo.dev.pixelmotiondemo.com/thumbs/rolls-roycemotorcarsoc/SCA665C50FUX85545/FO3s2-20190310163822.jpg',
            flip: 0,
            rotate: 0,
          },
          detail:
            'http://vehicle-photos-published.vauto.com/33/a5/c6/8a-3bdf-4fd5-9eec-5ca1c3126cd0/image-1.jpg',
        },
        video: '',
      },
      status: 'available',
      in_transit: false,
      featured: false,
      advertisement:
        "Low mileage, Rolls-Royce Provenance 2015 Rolls-Royce Wraith. <br><br><br>Dealer Options include:<br>Driver's Assistance 1,<br>Adaptive Headlights,<br>Polished Stainless Steel Package,<br>21'' Polished Stainless Steel Package,<br>Comfort Entry System,<br>High-Beam Assistance,<br>Lane Departure Warning,<br>Head-Up Display,<br>Camera System,<br><br>Bespoke Options:<br>RR monogram to all headrests,<br>SoE Inlays to Monitor Lid,<br>Treadplates - Wraith.<br><br>And much more!<br><br>Exterior in<br>Black.<br><br>Interior in<br>Black.<br><br>Please call or stop by for a test drive today.",
      dealerComments: '',
      vehicleCodes: {
        autodata: 'USC50RRC081A0',
        year: 'C50',
        engine: ['RR05'],
        language: 'EN',
        manufacturer: 'WRAITH1',
        engineOption: 'STDEN',
        installed: null,
      },
      accessories: [],
      pricingIncentive: [],
      flags: ['carfax-1-owner'],
      vdp_href:
        '/inventory/display/used/certified/2015/Rolls-Royce/Wraith/SCA665C50FUX85545',
      incentives: {
        bestOffer: [],
        select: [],
        conditional: [],
      },
      installedOptions: [
        'DVD / Entertainment',
        'Memory Seats',
        'Navigation System',
        'Rain Sensing Wipers',
        'Rear Air Conditioning',
      ],
      stats: [
        {
          label: 'Year&colon;',
          value: '2015',
          attributes: {
            class: 'vlp-vehicle-year',
          },
        },
        {
          label: 'Exterior Color&colon;',
          value: 'Diamond Black',
          attributes: {
            class: 'vlp-item-color-exterior',
          },
        },
        {
          label: 'Interior Color&colon;',
          value: 'Black',
          attributes: {
            class: 'vlp-item-color-interior',
          },
        },
        {
          label: 'Mileage&colon;',
          value: 22503,
          attributes: {
            class: 'vlp-item-mileage',
          },
        },
      ],
      cta_row: [
        {
          element: 'a',
          label: ' View Details',
          icon: '',
          attributes: {
            href:
              '/inventory/display/used/2015/Rolls-Royce/Wraith/SCA665C50FUX85545',
            class: 'cta-button btn view-details-btn',
          },
        },
      ],
      cta_column: [],
      misc_display: [],
    },
    {
      siteToken: 'rolls-roycemotorcarsoc',
      lotToken: 'rolls-roycemotorcarsoc',
      lotName: 'Rolls Royce Motor Cars OC',
      vin: 'SCA664S54EUX52719',
      condition: 'used',
      certified: true,
      year: '2014',
      make: 'Rolls-Royce',
      model: 'Ghost',
      trim: '',
      label: '2014 Rolls-Royce Ghost ',
      stockNum: 'P1054',
      acode: 'USC40RRC071A0',
      pricing: {
        display: [
          {
            label: 'Price&colon;',
            value: '&dollar;146,888',
            attributes: {
              class: 'base-price',
            },
          },
        ],
        data: {
          msrp: 0,
          internet: 146888,
          override: {
            cms: {
              total: 0,
              items: [],
            },
          },
          discount: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          markup: {
            total: 0,
            cms: {
              total: 0,
              items: [],
            },
            dms: {
              total: 0,
              items: [],
            },
          },
          incentive: {
            total: 0,
            conditionalTotal: 0,
            items: [],
            conditional: [],
            select: [],
          },
          final: 146888,
          conditional: 0,
          feed: {
            internet: 146888,
            invoice: null,
            priceFinal: 146888,
            onSale: false,
            range: {
              low: 295850,
              high: 329325,
            },
          },
        },
      },
      historicalPricing: [],
      monthlyPayment: [],
      engine: {
        nameFull: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        nameSimple: '6.6L V12 DGI DOHC 48V Twin Turbocharged',
        size: '6.6L',
        cylinders: null,
        fuel: 'Gasoline',
        mpgCity: '13',
        mpgHwy: '21',
        mpgE: null,
      },
      transmission: {
        description: '',
        driveTypeAbbr: 'RWD',
        driveTypeDesc: 'Rear-wheel Drive',
        speeds: '8',
        type: 'Automatic',
      },
      bodyStyle: 'Sedan',
      doors: '4',
      mileage: '14493',
      history: {
        daysInStock: '458',
        prevOwners: null,
      },
      color: {
        exterior: {
          name: 'Diamond Black',
          generic: 'Black',
          code: '',
          hex: null,
          rgb: null,
        },
        interior: {
          name: 'Moccasin/seashell',
          generic: 'Moccasin/seashell',
          code: '',
          hex: '',
          rgb: '',
        },
      },
      media: {
        image: {
          thumb: {
            src:
              'https://secure.images.demo.dev.pixelmotiondemo.com/thumbs/rolls-roycemotorcarsoc/SCA664S54EUX52719/KK57V-20190310163821.jpg',
            flip: 0,
            rotate: 0,
          },
          detail:
            'http://vehicle-photos-published.vauto.com/7d/15/2a/6c-17de-4d7f-aa98-10fda62d9376/image-1.jpg',
        },
        video: '',
      },
      status: 'available',
      in_transit: false,
      featured: false,
      advertisement:
        "This is a Low Mile, Well Maintained and Local/One Owner 2014 Rolls-Royce Ghost. <br><br>Exterior:<br>Diamond Black<br><br>Interior:<br>Moccasin<br>Seashell<br><br>Dealer Options:<br>Driver's Assistance 1<br>Camera System<br>Comfort Entry System<br>Panorama Sunroof<br>Front Ventilated Seats<br>Front Massage Seats<br>Individual Rear Seat Configuration<br>Adaptive Headlights<br>Natural Grain Leather<br>Lane Departure Warning<br>Head-Up Display<br>Picnic Tables<br>20'' Alloy Wheels",
      dealerComments: '',
      vehicleCodes: {
        autodata: 'USC40RRC071A0',
        year: 'C40',
        engine: ['RR01', 'RR04'],
        language: 'EN',
        manufacturer: 'GHOST',
        engineOption: 'STDEN',
        installed: null,
      },
      accessories: [],
      pricingIncentive: [],
      flags: ['carfax-1-owner'],
      vdp_href:
        '/inventory/display/used/certified/2014/Rolls-Royce/Ghost/SCA664S54EUX52719',
      incentives: {
        bestOffer: [],
        select: [],
        conditional: [],
      },
      installedOptions: [
        'DVD / Entertainment',
        'Memory Seats',
        'Navigation System',
        'Rain Sensing Wipers',
        'Rear Air Conditioning',
      ],
      stats: [
        {
          label: 'Year&colon;',
          value: '2014',
          attributes: {
            class: 'vlp-vehicle-year',
          },
        },
        {
          label: 'Exterior Color&colon;',
          value: 'Diamond Black',
          attributes: {
            class: 'vlp-item-color-exterior',
          },
        },
        {
          label: 'Interior Color&colon;',
          value: 'Moccasin/seashell',
          attributes: {
            class: 'vlp-item-color-interior',
          },
        },
        {
          label: 'Mileage&colon;',
          value: 14493,
          attributes: {
            class: 'vlp-item-mileage',
          },
        },
      ],
      cta_row: [
        {
          element: 'a',
          label: ' View Details',
          icon: '',
          attributes: {
            href:
              '/inventory/display/used/2014/Rolls-Royce/Ghost/SCA664S54EUX52719',
            class: 'cta-button btn view-details-btn',
          },
        },
      ],
      cta_column: [],
      misc_display: [],
    },
  ],
};

(function($) {
  VDP = {
    store: {},

    state: {
      thirdParty: [],
    },

    init: function() {
      if (!store) {
        console.log('data did not load');
      } else {
        this.store = store;
        var vehicle = this.store.vehicle;

        this.eventHandlers();

        //for use in setting background image
        $('#page').addClass(
          vehicle.make.toLowerCase() + '-' + vehicle.model.toLowerCase()
        );

        if (
          vehicle.hasOwnProperty('misc_display') &&
          vehicle.misc_display.length > 0
        ) {
          this.createMiscDisplayItems(vehicle.misc_display);
        }

        /** Third Party **/
        if (this.state.thirdParty.length > 0) {
          this.state.thirdParty.map(function(tp) {
            if (tp.hasOwnProperty('vdpInit')) {
              tp.vdpInit();
            }
          });
        }

        if (vehicle.similarVehicles.length === 0) {
          if ($(document).width() < 500) {
            $(window).scroll(VDP.similarVehiclesCallCheck);
          } else {
            VDP.getSimilarVehicles();
          }
        } else {
          this.updateSimilarVehicles();
        }

        if (
          vehicle.accessories.length &&
          (VDP.store.vehicle.vin === 'WB10A6103JZ657044' ||
            VDP.store.vehicle.vin === 'WB10A6108JZ657461' ||
            VDP.store.vehicle.vin === 'WB10J0300JZ698404' ||
            VDP.store.vehicle.vin === 'WB10A6105JZ657370')
        ) {
          this.getAccessories();
          $('#modalAccessory').on('hidden.bs.modal', function() {
            // "temporary" fix for youtube still playing when modal closes
            $('.accessory-gallery').html('');
          });
        }
      }

      this.checkForModalError();

      this.vdpSlidersChange();
    },

    eventHandlers: function() {
      /**
       * Slick Slider
       */
      $('#detail-images').slick({
        asNavFor: '#thumbnail-gallery',
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: true,
        fade: true,
      });

      var slidesToShow = 10;
      var slidesAvailable = $('#thumbnail-gallery').children().length - 1;
      if (slidesAvailable && slidesToShow > slidesAvailable) {
        slidesToShow = slidesAvailable;
      }

      $('#thumbnail-gallery').slick({
        asNavFor: '#detail-images',
        dots: false,
        arrows: true,
        infinite: true,
        autoplay: true,
        lazyLoad: 'ondemand',
        focusOnSelect: true,
        speed: 300,
        slidesToShow: slidesToShow,
        slidesToScroll: 1,
        adaptiveHeight: true,
      });

      /**
       * Specifications Accordion
       *
       * @delegated
       */
      $('#spec-accordion').on('click', '.panel-title', function() {
        var icon = $(this).find('.fa');
        VDP.toggleIcon(icon);
      });

      /**
       * Back Button
       */
      if (window.history.length > 1) {
        $('#vdp-back')
          .css('display', 'inline-block')
          .click(function() {
            window.history.back();
          });
      }

      /**
       * Vehicle Save
       */
      if ('VehicleSave' in window) {
        $('.save-vehicle').click(function() {
          var data = VDP.getSaveData();
          VehicleSave.save(data.vin, data, 'save');
        });
      }

      $('[data-toggle="modal"]').click(function() {
        localStorage.setItem('pm_modal_error', $(this).attr('data-target'));
      });

      $('.modal').on('hidden.bs.modal', function() {
        localStorage.removeItem('pm_modal_error');
      });

      $('.container').on('click', '.pre-approved-btn', function() {
        var href = location.pathname;
        var pathParts = href.split('/');
        var condition = pathParts[3];
        var year = pathParts[4];
        var make = pathParts[5];
        var model = pathParts[6];

        if (model.indexOf(make) !== -1) {
          var index = make.length + 1;
          model = model.slice(index);
        }

        localStorage.setItem('condition', condition);
        localStorage.setItem('year', year);
        localStorage.setItem('make', make);
        localStorage.setItem('model', model);
      });

      // $('div:not(.tooltip)').on('click', function() {
      //     $('.tooltip').removeClass('clicked');
      // });

      $('.tooltip').on('click', function() {
        $(this).toggleClass('clicked');
      });
    },

    similarVehiclesCallCheck: function() {
      if (window.pageYOffset > 500) {
        $(window).off('scroll', VDP.similarVehiclesCallCheck);
        VDP.getSimilarVehicles();
      }
    },

    getSimilarVehicles: function() {
      var data = {
        site_token: pm_api.site_token,
        vehicle: VDP.store.vehicle,
        ni,
      };
      $.ajax({
        url: pm_api.path + 'similarVehicles/get',
        method: 'post',
        data: $.param(data),
        success: function(response) {
          if (response.hasOwnProperty('in_stock')) {
            VDP.store.vehicle.similarVehicles = response.similar;
            VDP.store.vehicle.inStock = response.in_stock;
          } else {
            VDP.store.vehicle.similarVehicles = response;
          }
          VDP.updateSimilarVehicles();
        },
        error: function(response) {
          console.warn(response);
        },
      });
    },

    updateSimilarVehicles: function() {
      var vehicles = this.store.vehicle.similarVehicles;
      if (vehicles.length > 0) {
        var list = vehicles.map(function(item) {
          var $img = $('<img>')
            .addClass('similar-vehicle-image img-responsive')
            .attr({
              src: item.img,
              alt: item.label,
            });

          var $simVehicleImagery = $('<div>')
            .addClass('similar-vehicle-imagery')
            .append($img);

          var $simVehicleName = $('<div>')
            .addClass('similar-vehicle-name text-uppercase')
            .text(item.label + ' - ' + item.stockNum);

          if ('pm_api' in window) {
            if (pm_api.site_token === 'nchonda') {
              $simVehicleName.removeClass('text-uppercase');
            }
          }

          var $price = $('<strong>').html(PMUtilities.usCurrency(item.price));

          var $simVehiclePrice = $('<div>')
            .addClass('similar-vehicle-price')
            .append($price);

          var $simVehicleInfo = $('<div>')
            .addClass('similar-vehicle-info')
            .append($simVehicleName, $simVehiclePrice);

          var $col = $('<div>')
            .addClass('col-sm-3')
            .append($simVehicleImagery, $simVehicleInfo);

          return $('<a>')
            .addClass('similar-vehicle-link')
            .attr('href', item.vdpHref)
            .append($col)
            .click(function() {
              if ('VehicleSave' in window) {
                VehicleSave.save(item.vin, item, 'view');
              }
            });
        });

        $('#similar-vehicles-list').html(list);

        $('#similar-vehicles').removeClass('hidden');
      }
    },
    /* Accessories methods (Anyone feel free to rename, I'm not creative) */
    getAccessories: function() {
      var accessories = this.store.vehicle.accessories;
      var images = [];
      var list = [];

      accessories.forEach(function(accessory) {
        var $img = $('<img>')
          .addClass('accessory-image img-responsive')
          .attr({
            src: accessory.src,
            alt: accessory.title,
          });

        var $accImagery = $('<div>')
          .addClass('accessory-imagery')
          .append($img);

        var $accName = $('<div>')
          .addClass('accessory-name text-uppercase')
          .text(accessory.title);

        var $price = $('<strong>').html(
          PMUtilities.usCurrency(accessory.price)
        );

        var $accPrice = $('<div>')
          .addClass('accessory-price')
          .append($price);

        var $accInfo = $('<div>')
          .addClass('accessory-info')
          .append($accName, $accPrice);

        var $imgCol = $('<div>')
          .addClass('col-xs-6 col-md-2')
          .append($accImagery);

        var $div = $('<div>')
          .addClass('accessory-link')
          .append($imgCol)
          .click(VDP.getAccessoryModal.bind(this, accessory.id));

        images.push($div);

        var $check = $('<input>')
          .attr('type', 'checkbox')
          .attr('id', accessory.id)
          .prop('checked', true);

        var $label = $('<label>')
          .attr('for', accessory.id)
          .text(accessory.title + ' ($' + accessory.price + ') ');

        var $info = $('<i>')
          .addClass('fa fa-info-circle accessory-info')
          .click(VDP.getAccessoryModal.bind(this, accessory.id));

        $listCol = $('<div>')
          .addClass('col-xs-12')
          .append($check, $label, $info);

        list.push($listCol);
      });

      $('#accessories-images').html(images);
      $('#accessories-list').html(list);

      $('#accessories').removeClass('hidden');
    },

    getAccessoryModal: function(id) {
      $('.incentives-loader').show();
      $.ajax({
        url: pm_api.path + 'accessoryModal/' + id,
        type: 'get',
      }).then(function(response) {
        $('.incentives-loader').hide();
        console.log(response);
        var a = response[0];
        // alert(response[0].description)
        var $firstImg = $('<img>').attr('src', a.images[0]);
        var $detail = $('<div>')
          .append($('<h3>').text(a.name))
          .append(a.description)
          .append($('<h3>').text('$' + a.price));

        var thumbs = [];
        a.images.forEach(function(img) {
          var $img = $('<img>')
            .addClass('img')
            .attr('src', img)
            .click(VDP.accClickImg);
          thumbs.push($img);
        });

        a.videos.forEach(function(video) {
          var id = video.split('v=')[1];
          var $vidthumb = $('<img>')
            .addClass('video')
            .attr('src', 'https://img.youtube.com/vi/' + id + '/0.jpg')
            .attr('data-id', id)
            .click(VDP.accClickVideo);
          thumbs.push($vidthumb);
        });

        $('#modalAccessory .modal-body .accessory-gallery').html($firstImg);
        $('#modalAccessory .modal-body .accessory-thumbs').html(thumbs);
        $('#modalAccessory .modal-body .accessory-detail').html($detail);
        $('#modalAccessory').modal();
      });
    },

    getSelectedAccessories: function() {
      var checked = [];
      $('#accessories #accessories-list input[type="checkbox"]:checked').each(
        function() {
          var item = {};
          var $this = $(this);
          item.id = $this.attr('id');
          item.label = $('label[for="' + item.id + '"]').text();
          checked.push(item);
        }
      );
      return checked;
    },

    getQuoteWithAccessories: function() {
      var message = 'Selected Accessories: ';
      var i = 0;
      var checked = VDP.getSelectedAccessories();
      checked.forEach(function(accessory) {
        message += '\n' + accessory.label;
        i++;
      });

      if (checked.length)
        $('#modalQuickQuote #input_6_4').val('\n \n' + message);
    },

    accClickImg: function() {
      $el = $('.accessory-gallery');
      $img = $(this).clone();
      $('.selected').removeClass('selected');
      $(this).addClass('selected');
      $el.html($img);
    },

    accClickVideo: function() {
      $el = $('.accessory-gallery');
      var id = $(this).attr('data-id');
      $('.selected').removeClass('selected');
      $(this).addClass('selected');
      $video = $('<iframe>')
        .attr('src', 'https://www.youtube.com/embed/' + id + '?autoplay=1')
        .attr('allowfullscreen', 'true')
        .attr(
          'allow',
          'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture'
        );

      $el.html($video);
    },

    vdpSlidersChange: function() {
      var $detailImages = $('#detail-images');
      var $thumbnailGallery = $('#thumbnail-gallery');

      $detailImages.find('.slick-arrow').hide();
      $thumbnailGallery.find('.slick-arrow').hide();

      var $detailPrev = $('<i>')
        .addClass('fa fa-angle-left fa-5x')
        .click(function() {
          if (
            $thumbnailGallery
              .find('.slick-slide:first-child')
              .hasClass('slick-current')
          ) {
            $thumbnailGallery.find('.slick-slide:last-child').click();
          } else {
            $('.slick-current')
              .removeClass('slick-current')
              .prev('.slick-slide')
              .click();
          }
          $detailImages.find('.slick-prev').click();
        });

      var $detailNext = $('<i>')
        .addClass('fa fa-angle-right fa-5x')
        .click(function() {
          if (
            $thumbnailGallery
              .find('.slick-slide:last-child')
              .hasClass('slick-current')
          ) {
            $thumbnailGallery.find('.slick-slide:first-child').click();
          } else {
            $('.slick-current')
              .removeClass('slick-current')
              .next('.slick-slide')
              .click();
          }
          $detailImages.find('.slick-next').click();
        });

      var $thumbnailPrev = $('<i>')
        .addClass('fa fa-angle-left fa-lg')
        .click(function() {
          $detailPrev.click();
        });

      var $thumbnailNext = $('<i>')
        .addClass('fa fa-angle-right fa-lg')
        .click(function() {
          $detailNext.click();
        });

      $detailImages.append($detailPrev, $detailNext);
      $thumbnailGallery.append($thumbnailPrev, $thumbnailNext);
    },

    createMiscDisplayItems: function(misc) {
      var $element = $('#vehicle-display');
      misc.forEach(function(item) {
        var $miscItem = $('<' + item.element + '>')
          .attr(item.attributes)
          .html(item.html);
        var $target = $element.find(item.target);
        switch (item.action) {
          case 'before':
            $target.before($miscItem);
            break;
          case 'after':
            $target.after($miscItem);
            break;
          case 'prepend':
            $target.prepend($miscItem);
            break;
          default:
            $target.append($miscItem);
        }
      });
    },

    getSaveData: function() {
      var vehicle = VDP.store.vehicle;

      var price = vehicle.pricing.data.final;
      var color = '';

      if (vehicle.hasOwnProperty('color')) {
        if (vehicle.color.hasOwnProperty('exterior')) {
          if (vehicle.color.exterior.hasOwnProperty('name')) {
            color = vehicle.color.exterior.name;
          }
        }
      }
      return {
        vin: vehicle.vin,
        label: vehicle.label,
        condition: vehicle.condition,
        price:
          price > 1000
            ? '$' + price.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,')
            : 'Call for Price',
        year: vehicle.year,
        make: vehicle.make,
        model: vehicle.model,
        trim: vehicle.trim || '',
        mileage: vehicle.mileage,
        transmission: vehicle.transmission.type,
        driveType: vehicle.transmission.driveTypeAbbr,
        cylinders: vehicle.engine.cylinders,
        color: color,
        stockNum: vehicle.stockNum,
        img: vehicle.media.thumb ? vehicle.media.thumb : vehicle.media.image[0],
        vdpHref: vehicle.vdp_href,
      };
    },

    toggleIcon: function(element) {
      var $element = $(element);
      if ($element.hasClass('fa-caret-right')) {
        $('.fa-caret-down')
          .addClass('fa-caret-right')
          .removeClass('fa-caret-down');
        if ('dataLayer' in window) {
          dataLayer.push({ event: 'vdp-click', element: 'Open Panel' });
        }
        $element.removeClass('fa-caret-right').addClass('fa-caret-down');
      } else {
        if ('dataLayer' in window) {
          dataLayer.push({ event: 'vdp-click', element: 'Close Panel' });
        }
        $element.addClass('fa-caret-right').removeClass('fa-caret-down');
      }
    },

    getVehicle: function() {
      return this.store.vehicle;
    },

    checkForModalError: function() {
      if (localStorage.hasOwnProperty('pm_modal_error')) {
        var element = localStorage.getItem('pm_modal_error');
        $(element).modal('show');
        localStorage.removeItem('pm_modal_error');
      }
    },
  };
})(jQuery);

VDP.init();
